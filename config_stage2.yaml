# Configuration for stage2_train.py
# Stage 2: Leave-One-Ligand-Out (LOO) evaluation for selectivity refinement

# Model Version
# -------------
version: "v0"  # Used for output directory naming

# Input Paths
# -----------
input:
  # Stage 1 checkpoint to fine-tune from
  checkpoint_stage1: "models/v0/stage1_best.pt"
  
  # Ligand data CSV (must have: smiles, source, selectivity, target)
  ligand_csv: "data/ligands/smiles_binding_pdb_decoy.csv"
  
  # Pre-computed embeddings
  ligand_features: "data/ligand_features_cache/ligand_features_unimol.pkl"
  pocket_embeddings: "data/pocket_embeddings_cache/pocket_embeddings_unimol_cutoff8A.pkl"

# Output Paths
# ------------
output:
  # LOO fold checkpoints directory
  loo_dir: "models/v0/loo"
  
  # Aggregated results directory
  results_dir: "models/v0/results"
  
  # Per-fold checkpoint naming
  fold_checkpoint_name: "fold_{fold}_best.pt"
  
  # Per-fold result naming
  fold_predictions_holdout: "fold_{fold}_predictions_holdout.csv"
  fold_predictions_non_holdout: "fold_{fold}_predictions_non_holdout.csv"
  fold_metrics: "fold_{fold}_metrics.json"
  
  # Aggregated result naming
  loo_predictions: "stage_2_loo_predictions.csv"
  loo_metrics: "stage_2_loo_metrics.json"
  loo_confusion_plot: "stage_2_loo_confusion_matrices.png"

# Training Hyperparameters
# -------------------------
training:
  # Dataset configuration
  stage: "selectivity"  # Only PDB ligands for Stage 2
  
  # LOO configuration
  evaluation_strategy: "loo"  # Leave-One-Ligand-Out
  
  # Optimization (per fold fine-tuning)
  epochs: 100
  batch_size: 16
  learning_rate: 1.0e-4
  weight_decay: 1.0e-4
  
  # Reproducibility
  seed: 42
  
  # Device
  device: "auto"  # "auto", "cuda", "cpu"

# Evaluation
# ----------
evaluation:
  # Save per-fold checkpoints
  save_fold_checkpoints: true
  
  # Evaluate on both holdout and non-holdout
  evaluate_holdout: true
  evaluate_non_holdout: true
  
  # Generate per-source confusion matrices
  per_source_confusion: true
  
  # Print per-fold progress
  verbose: true
